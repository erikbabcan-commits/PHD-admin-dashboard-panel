<div class="fixed inset-0 bg-black/80 z-50 flex items-center justify-center animate-fade-in p-4" (click)="onClose()">
  <div class="bg-brand-dark border border-gold/20 rounded-lg shadow-xl w-full max-w-lg relative animate-zoom-in text-left flex flex-col" (click)="$event.stopPropagation()">
    <header class="p-6 border-b border-gold/20 flex justify-between items-center">
      <div>
        <h3 class="text-2xl font-bold text-gold">Vytvoriť Nový Termín</h3>
        @if(initialData(); as data) {
          <p class="text-brand-light/70">
            {{ data.date | date:'d. MMMM yyyy' }} o {{ data.hour }}:00
            @if(initialStylist(); as stylist) {
              <span class="font-semibold"> pre {{ stylist.name }}</span>
            }
          </p>
        }
      </div>
      <button (click)="onClose()" class="text-gray-400 hover:text-white transition-colors" aria-label="Zavrieť">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
      </button>
    </header>

    <form [formGroup]="appointmentForm" (ngSubmit)="onSave()" class="p-6 space-y-4">
      
      <!-- Customer -->
      <div>
        <label for="userId" class="block text-sm font-medium text-brand-light/80 mb-2">Zákazník</label>
        <select id="userId" formControlName="userId" class="w-full bg-brand-dark/80 border border-gray-600 rounded-md p-3 text-white focus:ring-gold focus:border-gold">
          <option value="" disabled>Vyberte zákazníka</option>
          @for(user of users(); track user.uid) {
            <option [value]="user.uid">{{ user.name }} ({{ user.email }})</option>
          }
        </select>
         @if(appointmentForm.get('userId')?.invalid && appointmentForm.get('userId')?.touched) {
          <p class="text-red-400 text-sm mt-1">Prosím, vyberte zákazníka.</p>
        }
      </div>

      <!-- Service -->
      <div>
        <label for="serviceId" class="block text-sm font-medium text-brand-light/80 mb-2">Služba</label>
        <select id="serviceId" formControlName="serviceId" class="w-full bg-brand-dark/80 border border-gray-600 rounded-md p-3 text-white focus:ring-gold focus:border-gold">
          <option value="" disabled>Vyberte službu</option>
          @for(service of services(); track service.id) {
            <option [value]="service.id">{{ service.name }} ({{ service.duration }} min)</option>
          }
        </select>
        @if(appointmentForm.get('serviceId')?.invalid && appointmentForm.get('serviceId')?.touched) {
          <p class="text-red-400 text-sm mt-1">Prosím, vyberte službu.</p>
        }
      </div>
      
      <!-- Stylist -->
      <div>
        <label for="stylistId" class="block text-sm font-medium text-brand-light/80 mb-2">Stylista</label>
        <select id="stylistId" formControlName="stylistId" class="w-full bg-brand-dark/80 border border-gray-600 rounded-md p-3 text-white focus:ring-gold focus:border-gold">
          <option value="" disabled>Vyberte stylistu</option>
          @for(stylist of stylists(); track stylist.id) {
            <option [value]="stylist.id">{{ stylist.name }}</option>
          }
        </select>
        @if(appointmentForm.get('stylistId')?.invalid && appointmentForm.get('stylistId')?.touched) {
          <p class="text-red-400 text-sm mt-1">Prosím, vyberte stylistu.</p>
        }
      </div>
      
      <!-- Date & Time -->
      <div class="grid grid-cols-2 gap-4">
        <div>
          <label for="date" class="block text-sm font-medium text-brand-light/80 mb-2">Dátum</label>
          <input type="date" id="date" formControlName="date" class="w-full bg-brand-dark/80 border border-gray-600 rounded-md p-3 text-white focus:ring-gold focus:border-gold">
        </div>
        <div>
          <label for="time" class="block text-sm font-medium text-brand-light/80 mb-2">Čas</label>
          <input type="time" id="time" formControlName="time" class="w-full bg-brand-dark/80 border border-gray-600 rounded-md p-3 text-white focus:ring-gold focus:border-gold">
        </div>
      </div>
      
      <footer class="pt-6 flex justify-end gap-4 border-t border-gold/20">
        <button type="button" (click)="onClose()" class="bg-gray-600 text-white font-bold py-2 px-6 rounded-full hover:bg-gray-500 transition-colors duration-300">
          Zrušiť
        </button>
        <button type="submit" class="bg-gold text-brand-dark font-bold py-2 px-6 rounded-full hover:bg-yellow-300 transition-colors duration-300 disabled:bg-gray-500 disabled:cursor-not-allowed" [disabled]="appointmentForm.invalid">
          Uložiť Termín
        </button>
      </footer>
    </form>
  </div>
</div>
